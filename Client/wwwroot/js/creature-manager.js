let dbWorker=null,lastDBWorkerUid=null;function SyncMonsterData(){dbWorker||(dbWorker=new Worker("/js/db-worker.js"))}function LookupCreature(query){return new Promise((resolve=>{dbWorker||resolve([]),lastDBWorkerUid=uid(),dbWorker.onmessage=e=>{const data=e.data;if(data.messageUid===lastDBWorkerUid){const creature={...data.creature};creature.BaseName=toUpper(creature.BaseName),resolve(JSON.stringify(creature))}else resolve(JSON.stringify([]))},dbWorker.postMessage({type:"lookup",query,messageUid:lastDBWorkerUid})}))}function AddCustomCreature(creature){dbWorker&&dbWorker.postMessage({type:"add",creature})}function GetCreatures(){return new Promise((resolve=>{dbWorker||resolve([]),lastDBWorkerUid=uid(),dbWorker.onmessage=e=>{const data=e.data;data.messageUid===lastDBWorkerUid?resolve(JSON.stringify(data.creatures)):resolve(JSON.stringify([]))},dbWorker.postMessage({type:"get",messageUid:lastDBWorkerUid})}))}function uid(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}